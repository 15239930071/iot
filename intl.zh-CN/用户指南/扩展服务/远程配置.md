# 远程配置 {#concept_om1_tgs_c2b .concept}

## 前提条件 {#section_xlf_qp5_c2b .section}

-   已开通远程配置服务，如果未开通，登录物联网平台的控制台，选择扩展服务，单击远程配置下的**开通服务**。
-   设备端SDK已开启支持远程配置服务。需要在设备端SDK中定义 `FEATURE_SERVICE_OTA_ENABLED = y`，SDK提供接口linkkit\_cota\_init来初始化远程配置（Config Over The Air，COTA）。

## 远程配置说明 {#section_qlv_fls_c2b .section}

很多场景下，开发者需要更新设备的配置信息，包括设备的系统参数、网络参数或者本地策略等等。通常情况下更新设备的配置信息是通过固件升级的方式完成的。这将加大固件版本的维护工作，并且需要设备中断运行以完成更新。为了解决上述问题，物联网平台为您提供了远程配置更新的功能，设备无需重启或中断运行即可在线完成配置信息的更新。

物联网平台提供的远程配置功能，可支持开发者：

-   开启/关闭远程配置；
-   在线编辑配置文件并支持版本管理；
-   向设备批量更新配置信息；
-   支持设备主动请求更新配置信息。

远程配置流程图如下所示：

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436235_zh-CN.png)

远程配置大致分为三部分：

-   配置生成，您在IoT控制台编辑并保存配置信息；
-   配置使用，您在IoT控制台批量推送配置信息给设备，设备接收后修改本地配置文件；
-   主动请求，设备主动向云端请求新的配置文件并进行更新。

## 开启远程配置 {#section_dtz_hls_c2b .section}

开启远程配置分为两种场景，一种是云端下发配置信息给设备端的场景，一种是设备端主动查询配置信息的场景。根据场景的不同，开启远程配置的步骤也有所区别。

**场景一**

设备接收云端的配置信息，可按如下步骤进行远程配置。

1.  设备上线，订阅推送配置信息的topic\(/sys/$\{productKey\}/$\{deviceName\}/thing/config/push\)。
2.  在IoT控制台中开启远程配置。
    1.  登录物联网平台的控制台，选择扩展服务。
    2.  单击**远程配置**，进入服务详情页面，单击**使用服务**。
    3.  选择产品，打开远程配置后的远程配置开关。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436236_zh-CN.png)

        **说明：** 

        -   必须开启远程配置功能后，才可以编辑配置信息。
        -   切换为关闭状态，即可关闭远程配置。
    4.  在编辑区，单击**编辑**直接编写配置信息或拷贝配置信息到编辑区。产品配置模板适用于该产品下的所有设备，目前不支持对单个设备进行配置更新。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436237_zh-CN.png)

        -   远程配置采用JSON格式，物联网平台对配置内容没有特殊要求，但系统会在提交时对内容进行JSON格式校验，避免错误格式引起配置异常；
        -   配置文件最大支持64KB，编辑框右上角将实时显示当前文件的大小，超过64KB的配置文件无法提交。
    5.  编辑完成配置信息后，需要单击**更新**，此时将生成正式的配置文件，允许设备主动请求更新该配置信息。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436238_zh-CN.png)

    6.  配置文件提交后，云端不会立即向设备推送更新，需要单击**批量更新**，此时系统会向该产品下的所有设备批量推送配置文件更新。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436239_zh-CN.png)

        **说明：** 

        -   批量更新一小时内仅允许操作一次 ，请勿频繁操作；
        -   如果您希望停止批量推送更新，单击远程配置开关，关闭远程配置，系统将停止所有更新推送，并且拒绝设备主动请求更新。
    7.  可查看远程配置修改记录。

        远程配置默认保存最近5次的配置修改记录，每次编辑并提交后，上一次配置将显示在版本记录列表中，您可以查看版本更新时间和配置内容，方便追溯。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436240_zh-CN.png)

        在列表中单击**查看**，将显示该版本的配置内容，单击**恢复至此版本**，自动将所选版本中的内容恢复至编辑区中，您可以直接编辑修改并更新。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/14736/15402787436241_zh-CN.png)

3.  设备端接收云端下发的配置信息后，自动更新配置。

**场景二**

在一些场景中，设备需要主动查询配置信息，可按如下步骤进行远程配置。

1.  设备端订阅topic\(/sys/$\{productKey\}/$\{deviceName\}/thing/config/get\_reply\)。
2.  在IoT控制台中开启远程配置。详细步骤请参见[2](#step2)。
3.  设备端用户使用接口linkkit\_invoke\_cota\_get\_config来触发云端远程配置的请求。
4.  设备通过topic\(/sys/$\{productKey\}/$\{deviceName\}/thing/config/get\)，主动查询最新的配置信息。
5.  接收到设备的请求后云端会返回最新的配置信息到设备中。
6.  设备端用户在回调函数cota\_callback中去处理远程配置下发的配置文件。

