# 定义物模型 {#concept_okp_zlv_tdb .concept}

物模型指将物理空间中的实体数字化，并在云端构建该实体的数据模型。在物联网平台中，定义物模型即定义产品功能。完成功能定义后，系统将自动生成该产品的物模型。物模型描述产品是什么，能做什么，可以对外提供哪些服务。

## 产品功能分类 {#section_srr_1f4_vdb .section}

产品功能类型分为三类：属性、服务、和事件。

|功能类型|说明|
|:---|:-|
|属性（Property）|一般用于描述设备运行时的状态，如环境监测设备所读取的当前环境温度等。属性支持 GET 和 SET 请求方式。应用系统可发起对属性的读取和设置请求。|
|服务（Service）|设备可被外部调用的能力或方法，可设置输入参数和输出参数。相比于属性，服务可通过一条指令实现更复杂的业务逻辑，如执行某项特定的任务。|
|事件（Event）|设备运行时的事件。事件一般包含需要被外部感知和处理的通知信息，可包含多个输出参数。如，某项任务完成的信息，或者设备发生故障或告警时的温度等，事件可以被订阅和推送。|

## 定义功能 {#section_xxh_z24_vdb .section}

成功创建高级版产品后，您可以为产品逐条新增自定义功能。

1.  登录[物联网平台控制台](http://iot.console.aliyun.com/)。
2.  在产品列表页面，单击产品所对应的**查看**操作按钮。
3.  单击**功能定义** \> **新增**。
4.  选择要添加的功能类型：**属性**、**服务**、或**事件**，并输入信息后，单击**确定**。

在以下章节中，我们将分别具体说明新增属性、新增服务、和新增事件需定义的具体参数。

产品的功能定义完成后，您可以在功能定义页面，单击**查看物模型**查看 JSON 格式的功能描述。您还可以单击某个功能对应的**编辑**操作按钮，重新编辑该功能。

## 新增属性 {#section_w4t_x44_vdb .section}

定义功能时，在添加功能页面，选择功能类型为**属性**。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/12829/2462_zh-CN.png)

-   功能名称：属性的名称，如用电量。同 一个产品下功能名称不能重复。如果您创建产品时选择了功能模板，输入功能名称时，将自动从标准功能库中筛选匹配的标准属性，供您选择。
-   标识符：属性唯一标识符，在产品中具有唯一性。即 Alink JSON 格式中的identifier的值，作为设备上报该属性数据的 Key，云端根据该标识符校验是否接收数据。可包含英文、数字、下划线，如 PowerComsuption。
-   数据类型：属性类型。可选择**int32**（32位整型）、**float**（单精度浮点型）、**double**（双精度浮点型）、**enum**（枚举型）、**bool**（布尔型）、**text**（字符串）、**date**（时间戳）、**struct**（JSON对象）、和**array**（数组）。
    -   int32/float/double：需定义取值范围和单位符号。
    -   enum：定义枚举项的参数值和参数描述，如 1-加热模式、2-制冷模式。
    -   bool：采用 0 或 1 来定义布尔值，如 0-关、1-开。
    -   text：需定义字符串的数据长度，最长支持 1024 字节。
    -   date：格式为 string 类型的 UTC 时间戳，单位：毫秒。
    -   struct：定义一个 JSON 结构体，新增 JSON 参数项，如定义灯的颜色是由 Red、Green、Blue 三个参数组成的结构体。不支持结构体嵌套。
    -   array：需声明数组内元素的数据类型，可选择**int32**、**float**、**double**、或**text**。需确保同一个数组元素类型相同，数组长度最长不超过 128 个元素。
-   读写类型：支持选择**读写**和**只读**。请求读写的方法支持 GET（获取）和 SET（设置），请求只读的方法仅支持 GET（获取）。
-   描述：对该功能进行说明或备注。

## 新增服务 {#section_zww_tp4_vdb .section}

定义功能时，在添加功能页面，选择功能类型为**服务**。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/12829/2473_zh-CN.png)

-   功能名称：服务名称。如果您创建产品时选择了功能模板，输入功能名称时，将自动从标准功能库中筛选匹配的标准服务，供您选择。
-   标识符：服务唯一标识符，在产品下具有唯一性。即 Alink JSON 格式中该服务的identifier的值，作为设备上报该属性数据的 Key。可包含英文、数字、和下划线。
-   调用方式：可选择**异步**或**同步**。服务为异步调用时，云端执行调用后直接返回结果，不会等待设备的回复消息。服务为同步调用时，云端会等待设备回复；若设备没有回复，则调用超时。
-   输入参数（可选）：该服务的入参。单击**新增参数**，在弹窗对话框中添加一个服务入参。您可以直接选择某个属性作为入参，也可以自定义参数。如在定义自动喷灌服务功能时，将已定义的属性喷灌时间和喷灌量作为自动喷灌服务的入参，则调用该参数时传入这两个参数，喷灌设备将按照设定的喷灌时间和喷灌量自动进行精准灌溉。

    **说明：** 一个服务最多支持定义 10 个入参。

-   输出参数（可选）：该服务的出参。单击**新增参数**，在弹窗对话框中添加一个服务出参。您可以直接选择某个属性作为出参，也可以自定义参数，如将已定义的属性土壤湿度作为出参，则云端调用自动喷灌服务时，将返回当前土壤湿度的数据。

    **说明：** 一个服务最多支持定义10个出参。

-   描述：对该服务功能进行说明或备注。

## 新增事件 {#section_dfw_3ns_vdb .section}

定义功能时，在添加功能页面，选择功能类型为**事件**。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/12829/2481_zh-CN.png)

-   功能名称：事件的名称。
-   标识符：事件唯一标识符，在产品下具有唯一性。即 Alink JSON 格式中该事件的identifier的值，作为设备上报该属性数据的 Key，如 ErrorCode。
-   事件类型：可选**信息**、**告警**、或**故障**。**信息**是设备上报的一般性通知，如完成某项任务等。**告警**和**故障**是设备运行过程中主动上报的突发或异常情况，优先级高。您可以针对不同的事件类型进行业务逻辑处理和统计分析。
-   输出参数（可选）：该事件的出参。单击**新增参数**，在弹窗对话框中添加一个服务出参。您可以直接选择某个属性作为出参，也可以自定义参数。如，将已定义的属性电压作为出参，则设备上报该故障事件时，将携带当前设备的电压值，用于进一步判断故障原因。

    **说明：** 一个事件最多支持定义10个出参。

-   描述：对该事件功能进行说明或备注。

## 物模型 JSON 字段说明 {#section_ldw_gys_vdb .section}

完成产品的所有功能定义后，系统将自动生成该产品的物模型。物模型以 JSON 格式表述，称之为 TSL（即 Thing Specification Language）。在产品的功能定义页面，单击**查看物模型**即可查看 JSON 格式的 TSL。以下是物模型的 JSON 字段说明。

```

{
"schema": "物的TSL描述schema",
"link": "云端系统级uri,用来调用服务/订阅事件",
"profile": {
"productKey": "产品key",
"deviceName": "设备名称"
},
"properties": [
{
"identifier": "属性唯一标识符(产品下唯一)",
"name": "属性名称",
"accessMode": "属性读写类型，只读(r)，读写(rw)",
"required": "标准品类中的必选是否是标准功能的必选属性",
"dataType": {
"type": "属性类型: int(原生)，float(原生)，double(原生), text(原生)，date(String类型UTC毫秒)，bool(0或1的int类型)，enum(int类型), struct(结构体类型，可包含前面6种类型)，array(数组类型，支持int/double/float/text)",
"specs": {
"min": "参数最小值(int, float, double类型特有)",
"max": "参数最大值(int, float, double类型特有)",
"unit": "属性单位",
"unitName": "单位名称",
"size":"数组大小，默认最大128(数组特有)",
"item": {
"type":"数组元素的类型"
}
}
}
}
],
"events": [
{
"identifier": "事件唯一标识符(产品下唯一，其中post是默认生成的属性上报事件)",
"name": "事件名称",
"desc": "事件描述",
"type": "事件类型(info,alert,error)",
"required": "是否是标准功能的必选事件",
"outputData": [
{
"identifier": "参数唯一标识符",
"name": "参数名称",
"dataType": {
"type": "属性类型: int(原生)，float(原生)，double(原生), text(原生)，date(String类型UTC毫秒)，bool(0或1的int类型)，enum(int类型), struct(结构体类型，可包含前面6种类型)，array(数组类型，支持int/double/float/text)",
"specs": {
"min": "参数最小值(int, float, double类型特有)",
"max": "参数最大值(int, float, double类型特有)",
"unit": "属性单位",
"unitName": "单位名称",
"size":"数组大小，默认最大128(数组特有)",
"item": {
"type":"数组元素的类型"
}
}
}
}
],
"method": "事件对应的方法名称(根据identifier生成)"
}
],
"services": [
{
"identifier": "服务唯一标识符(产品下唯一，产品下唯一，其中set/get是根据属性的accessMode默认生成的服务)",
"name": "服务名称",
"desc": "服务描述",
"required": "是否是标准功能的必选服务",
"inputData": [
{
"identifier": "入参唯一标识符",
"name": "入参名称",
"dataType": {
"type": "属性类型: int(原生)，float(原生)，double(原生), text(原生)，date(String类型UTC毫秒)，bool(0或1的int类型)，enum(int类型), struct(结构体类型，可包含前面6种类型)，array(数组类型，支持int/double/float/text)",
"specs": {
"min": "参数最小值(int, float, double类型特有)",
"max": "参数最大值(int, float, double类型特有)",
"unit": "属性单位",
"unitName": "单位名称",
"size":"数组大小，默认最大128(数组特有)",
"item": {
"type":"数组元素的类型"
}
}
}
}
],
"outputData": [
{
"identifier": "出参唯一标识符",
"name": "出参名称",
"dataType": {
"type": "属性类型: int(原生)，float(原生)，double(原生), text(原生)，date(String类型UTC毫秒)，bool(0或1的int类型)，enum(int类型), struct(结构体类型，可包含前面6种类型)，array(数组类型，支持int/double/float/text)",
"specs": {
"min": "参数最小值(int, float, double类型特有)",
"max": "参数最大值(int, float, double类型特有)",
"unit": "属性单位",
"unitName": "单位名称",
"size":"数组大小，默认最大128(数组特有)",
"item": {
"type":"数组元素的类型(数组特有)"
}
}
}
}
],
"method": "服务对应的方法名称(根据identifier生成)"
}
]
}
```

