# 固件升级 {#task_prw_fzz_xdb .task}

本章节主要介绍固件服务的控制台使用说明，帮助用户快速使用固件服务。目前仅华东2节点支持固件服务。

-   已开通固件升级服务，如果未开通，登录物联网平台的控制台，选择扩展服务，单击固件升级下的**使用服务**。
-   设备端SDK已默认开启支持OTA升级服务。

固件升级的步骤大致有：

1.  添加固件
2.  验证固件
3.  批量升级
4.  再次升级

具体操作步骤如下：

1.   登录物联网平台的控制台。 
2.   选择华东2区域节点。 
3.   添加固件。 
    1.   选择**我的服务** \> **固件升级**。 
    2.   在固件升级页面，单击**新增固件**，如[图 1](#fig_dyw_k11_ydb)所示。 

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/7553/3946_zh-CN.png "添加固件")

    3.   设置固件参数。 
        -   上传的固件文件名称不能包含特殊字符，仅支持中文、英文字母、数字和下划线，长度限制1~32。
        -   上传的固件文件大小不能超过10M。
        -   用户最多能上传100个固件文件。

            **说明：** 已删除的也包括在100个固件文件内。

4.   验证固件。 

    添加完固件后，必须先使用少量设备来验证固件是否可用。若验证固件可用，此固件才可以在大量设备上投入使用。

    在固件列表上选择某一固件，单击**验证固件**。

    -   验证固件会向MQTT接入的设备推送升级通知，在线设备会立即接收到升级通知，不在线的设备下次接入时，系统会再重新推送一次。

        其他接入方式（如CoAP或者HTTPS）的设备都是短连接的，所以不在线无法收到。

    -   可以反复发起验证固件，验证固件的本质就是指定少量设备进行升级。
    -   只要用户进行过验证固件操作，未验证的固件的状态就会被置为已验证，不会取决于设备的实际升级结果。
    -   验证固件操作结束，系统会记录下设备相应的升级操作记录（初始状态是待升级），只有设备收到升级通知后上传升级进度后，系统才会认为升级正式开始（升级操作记录状态更新为升级中）。升级开始后，可以在固件详情页，查看设备的升级进度信息。
5.   当进行过验证固件后，确认固件对设备是可用的，可以进行批量升级。在固件列表选择某一固件，单击**批量升级**。 

    批量升级的本质是对大批设备定向推送升级通知。

    -   禁止使用未验证的固件进行批量升级操作。
    -   设备从收到升级通知开始直至升级完成是一个渐进的过程，OTA系统在收到设备主动上报的升级进度后更新设备升级进度百分比信息。
    -   批量升级所覆盖的设备可能会因为设备上一次的升级动作没有结束，导致本次升级中部分设备升级失败。
    -   设备在实际升级过程中出现错误，比如说下载失败、校验失败和解压失败等，并且通知给OTA系统后，系统会将本次升级动作置为完成，升级失败。
    -   可以在固件详情页，查看批量升级对应设备的升级情况，升级失败列表选项卡会显示简要的升级失败原因。
    批量升级任务冲突，同一产品下，创建批量升级时，如果选择的待升级版本号，已经处于另一个固件的批量升级过程中，则会提示升级任务冲突。

    示例：同一产品下，某一个设备固件版本号为A，用户在控制台创建了两个固件，版本号分别为B和C。用户在控制台创建了固件B的批量升级，升级策略为从版本A到版本B。此时，如果用户想创建固件C的批量升级，升级策略为从版本A到版本C，则云端会触发升级任务冲突。

6.   若某些设备上一次升级失败，用户可以使用失败的升级操作记录尝试再次发起升级。 

